<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>부태리 계산기 허브 – 4개 탭</title>
  <style>
    :root{
      --bg:#0b0c10; --card:#151822; --text:#e8eaf0; --muted:#96a0b5;
      --accent:#4caf50; --accent-weak:#3a8f40; --tab:rgba(255,255,255,.06);
      --tab-active:linear-gradient(180deg, rgba(76,175,80,.18), rgba(76,175,80,.06));
      --ring:rgba(76,175,80,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",Arial,sans-serif;
      background:linear-gradient(180deg,#0b0c10 0%,#0f1220 100%); color:var(--text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(150%) blur(8px); background:rgba(11,12,16,.6); border-bottom:1px solid rgba(255,255,255,.06)}
    .wrap{max-width:1080px; margin:0 auto; padding:18px 16px}
    h1{margin:0; font-size:clamp(20px,2.8vw,28px); letter-spacing:-.2px}
    .sub{color:var(--muted); font-size:13px}

    .header-top{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:4px}
    /* 방문수 배지 */
    #daily-visitors{
      display:inline-flex; align-items:center; gap:.45em;
      padding:.38em .7em; border-radius:999px; font-size:12px; line-height:1;
      color:#e6f6ea; background:rgba(88,199,120,.12); border:1px solid rgba(88,199,120,.28)
    }
    #daily-visitors .dot{width:.5em; height:.5em; border-radius:50%; background:#58c778; box-shadow:0 0 0 3px rgba(88,199,120,.28)}

    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-top:14px}
    [role="tab"]{
      appearance:none; border:1px solid rgba(255,255,255,.06); background:var(--tab); color:var(--text);
      padding:10px 14px; border-radius:999px; font-weight:700; font-size:14px; cursor:pointer; transition:all .18s ease
    }
    [role="tab"].active{background:var(--tab-active); border-color:var(--accent-weak); box-shadow:0 0 0 3px var(--ring) inset}
    [role="tab"]:hover{transform:translateY(-1px)}

    .panel{
      margin:18px auto 28px; background:var(--card); border:1px solid rgba(255,255,255,.06);
      border-radius:18px; padding:10px; overflow:hidden
    }
    .panel[hidden]{display:none}
    iframe{width:100%; border:0; border-radius:12px; background:#fff; min-height:1200px}

    footer.page{border-top:1px solid rgba(255,255,255,.06); text-align:center; color:var(--muted); font-size:13px; padding:28px 0 36px}
    footer.page a{color:#cfe6ff; text-decoration:none}

    /* === 팝업(모달) === */
    .modal-backdrop[hidden]{display:none}
    .modal-backdrop{
      position:fixed; inset:0; z-index:1000; display:grid; place-items:center;
      background:rgba(0,0,0,.55); backdrop-filter:blur(4px); overscroll-behavior:contain
    }
    .modal{
      position:relative; width:min(960px,96vw); max-height:92vh; background:var(--card);
      border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:0 16px 60px rgba(0,0,0,.35);
      display:flex; flex-direction:column; overflow:hidden; overscroll-behavior:contain
    }
    .modal-body{
      flex:1 1 auto; min-height:60vh; background:#111; overflow:auto; -webkit-overflow-scrolling:touch; touch-action:pan-y; overscroll-behavior:contain
    }
    .modal-body iframe{width:100%; border:0; border-radius:0; background:#fff; display:block; height:auto; min-height:60vh}
    .modal-footer{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 14px calc(12px + env(safe-area-inset-bottom)); background:rgba(8,12,16,.72);
      border-top:1px solid rgba(255,255,255,.08); box-shadow:0 -10px 30px rgba(0,0,0,.35); z-index:10
    }
    .checkbox{display:flex; align-items:center; gap:10px; font-size:14px; color:#f4fff7; font-weight:700; text-shadow:0 1px 1px rgba(0,0,0,.6)}
    .checkbox input{width:18px; height:18px; margin:0; accent-color:var(--accent)}
    .checkbox input:focus-visible{outline:2px solid var(--ring); outline-offset:2px}

    .btn{appearance:none; border:1px solid rgba(255,255,255,.14); color:var(--text); background:var(--tab); padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer}
    .btn:hover{transform:translateY(-1px); box-shadow:0 0 0 3px var(--ring) inset}

    /* 상단 X 닫기 버튼 */
    .modal-x{
      position:absolute; top:calc(8px + env(safe-area-inset-top)); right:10px; width:40px; height:40px;
      display:grid; place-items:center; border-radius:10px; border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.45); color:#fff; font-size:20px; font-weight:800; z-index:20; cursor:pointer
    }
    .modal-x:active{transform:scale(.98)}

    @media (max-width:640px){
      .modal{width:100vw; height:100vh; max-height:100vh; border-radius:0}
      .modal-footer{padding:12px 14px calc(12px + env(safe-area-inset-bottom))}
    }
    @supports (height:100dvh){
      @media (max-width:640px){
        .modal{height:100dvh; max-height:100dvh}
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="header-top">
        <div>
          <h1>부태리 계산기 허브</h1>
          <div class="sub">내 투자/대출/경비 계산 도구를 한 곳에서</div>
        </div>
        <div id="daily-visitors" aria-label="오늘 방문수" title="전역 방문수(오늘)">
          <span class="dot" aria-hidden="true"></span>
          <span>오늘 방문수</span>
          <strong id="visitor-count">–</strong>
        </div>
      </div>

      <div class="tabs" role="tablist" aria-label="계산기 선택">
        <button id="tab-invest-loan" class="active" role="tab" aria-selected="true" aria-controls="panel-invest-loan">내 자산 + 연봉에 맞는 금액대</button>
        <button id="tab-cost" role="tab" aria-selected="false" aria-controls="panel-cost">부동산 매수 경비 계산기</button>
        <button id="tab-loan" role="tab" aria-selected="false" aria-controls="panel-loan">부동산 대출 계산기 </button>
        <button id="tab-map" role="tab" aria-selected="false" aria-controls="panel-map">LTV+급여 투자맵</button>
      </div>
      <div class="help">💡 팁: 각 탭을 클릭하거나 주소 뒤에 <code>#invest-loan</code>, <code>#cost</code>, <code>#loan</code>, <code>#map</code>을 붙이면 바로 열 수 있어요.</div>
    </div>
  </header>

  <main class="wrap">
    <!-- Panel 1 -->
    <section id="panel-invest-loan" class="panel" role="tabpanel" aria-labelledby="tab-invest-loan">
      <iframe title="내 자산 + 연봉에 맞는 금액대" data-file="투자 가능 단지 찾기(대출계산기) r6.html" loading="eager"></iframe>
    </section>

    <!-- Panel 2 -->
    <section id="panel-cost" class="panel" role="tabpanel" aria-labelledby="tab-cost" hidden>
      <iframe title="부동산 매수 경비 계산기" data-file="1. 부동산 매수 경비 산출 계산기 -r2.html" loading="lazy"></iframe>
    </section>

    <!-- Panel 3 -->
    <section id="panel-loan" class="panel" role="tabpanel" aria-labelledby="tab-loan" hidden>
      <iframe title="부동산 대출 계산기" data-file="20250413대출계산기-r5.html" loading="lazy"></iframe>
    </section>

    <!-- Panel 4 -->
    <section id="panel-map" class="panel" role="tabpanel" aria-labelledby="tab-map" hidden>
      <iframe title="LTV+급여 투자맵" data-file="LTV+급여로 본 투자맵.html" loading="lazy"></iframe>
    </section>

    <footer class="page">
      <div><strong>협업 및 수정 문의</strong> · <a href="https://litt.ly/richdadtechtree" target="_blank" rel="noopener">https://litt.ly/richdadtechtree</a></div>
      <div style="margin-top:8px; font-size:12px;">
        <a href="#" id="reopen-intro" style="color:#cfe6ff; text-decoration:underline;">신고가 팝업 다시보기</a>
      </div>
    </footer>
  </main>

  <!-- === 최초 방문/재방문 시 표시되는 팝업(모달) === -->
  <div id="intro-modal" class="modal-backdrop" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-label="부태리 신고가">
      <button class="modal-x" id="intro-close-x" aria-label="닫기" title="닫기">✕</button>
      <div class="modal-body">
        <iframe id="intro-iframe" title="부태리 신고가" data-src="부태리신고가.html"></iframe>
      </div>
      <div class="modal-footer">
        <label class="checkbox" for="dont-show-today">
          <input type="checkbox" id="dont-show-today" /> 오늘 하루 열지 않기
        </label>
        <div style="display:flex; gap:8px; align-items:center;">
          <button class="btn" id="intro-close">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      /* ====== 탭 ====== */
      const tabs = Array.from(document.querySelectorAll('[role="tab"]'));

      function encodeSrc(iframe){
        if (iframe && !iframe.dataset.loaded) {
          try { iframe.src = encodeURI(iframe.dataset.file); } catch (e) { iframe.src = iframe.dataset.file; }
          iframe.dataset.loaded = 'true';
        }
      }
      function resizeIframe(iframe){
        try {
          const doc = iframe.contentDocument || iframe.contentWindow.document;
          if (!doc) return;
          const setHeight = () => {
            const body = doc.body, html = doc.documentElement;
            const h = Math.max(
              body.scrollHeight, body.offsetHeight,
              html.clientHeight, html.scrollHeight, html.offsetHeight
            );
            iframe.style.minHeight = Math.max(900, h + 24) + 'px';
          };
          new MutationObserver(setHeight).observe(doc.documentElement, { childList:true, subtree:true, attributes:true });
          iframe.contentWindow.addEventListener('load', setHeight);
          window.addEventListener('resize', setHeight);
        } catch (e) { /* 교차 출처면 고정 높이 */ }
      }
      function activateTab(tab){
        tabs.forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected','false');
          const p = document.getElementById(t.getAttribute('aria-controls'));
          if (p) p.hidden = true;
        });
        tab.classList.add('active');
        tab.setAttribute('aria-selected','true');
        const panel = document.getElementById(tab.getAttribute('aria-controls'));
        if (panel) {
          panel.hidden = false;
          const iframe = panel.querySelector('iframe');
          encodeSrc(iframe);
          resizeIframe(iframe);
        }
        history.replaceState(null, '', '#' + tab.id.replace('tab','').replace(/^-/,'')); 
      }
      tabs.forEach(t => t.addEventListener('click', () => activateTab(t)));
      const hash = location.hash.replace('#','');
      const initial = hash ? document.getElementById('tab-' + hash) : tabs[0];
      activateTab(initial || tabs[0]);
      document.addEventListener('keydown', e => {
        if (!['ArrowLeft','ArrowRight'].includes(e.key)) return;
        const idx = tabs.findIndex(t => t.classList.contains('active'));
        const next = e.key === 'ArrowRight' ? (idx + 1) % tabs.length : (idx - 1 + tabs.length) % tabs.length;
        activateTab(tabs[next]);
      });

      /* ====== 한국시간 오늘 키 ====== */
      function todayKeySeoul(){
        try {
          const f = new Intl.DateTimeFormat('en-CA', { timeZone:'Asia/Seoul', year:'numeric', month:'2-digit', day:'2-digit' });
          return f.format(new Date()); // YYYY-MM-DD
        } catch (e) {
          const d = new Date(Date.now() + 9*60*60*1000);
          return d.toISOString().slice(0,10);
        }
      }

      /* ====== 방문자수 (전역 합계: GAS + JSONP 폴백) ====== */
      const WEBAPP_URL = 'YOUR_GAS_WEBAPP_URL';  /* ← 본인 GAS 웹앱 URL(https://script.google.com/macros/s/.../exec) */
      function renderCount(data){
        const el = document.getElementById('visitor-count');
        el.textContent = Number(data.today).toLocaleString('ko-KR');
        el.setAttribute('title', `누적 합계: ${Number(data.total).toLocaleString('ko-KR')}회 (기준일 ${data.date})`);
      }
      function jsonp(url, timeout=4000){
        return new Promise((resolve, reject) => {
          const cbName = 'visitor_cb_' + Math.random().toString(36).slice(2);
          const script = document.createElement('script');
          let done = false;
          function cleanup(){
            if (done) return;
            done = true;
            try { delete window[cbName]; } catch(_){}
            if (script && script.parentNode) script.parentNode.removeChild(script);
          }
          const timer = setTimeout(function(){ cleanup(); reject(new Error('JSONP timeout')); }, timeout);
          window[cbName] = function(data){ clearTimeout(timer); cleanup(); resolve(data); };
          script.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cbName + '&t=' + Date.now();
          script.onerror = function(){ clearTimeout(timer); cleanup(); reject(new Error('JSONP error')); };
          document.head.appendChild(script);
        });
      }
      async function updateVisitorCountGlobal(){
        const el = document.getElementById('visitor-count');
        try{
          if (!WEBAPP_URL || !/^https?:\/\//.test(WEBAPP_URL)) throw new Error('WEBAPP_URL not set');
          const ctrl = new AbortController();
          const timer = setTimeout(function(){ ctrl.abort(); }, 2500);
          const res = await fetch(WEBAPP_URL + '?action=hit&t=' + Date.now(), {
            method:'GET', signal:ctrl.signal, credentials:'omit', cache:'no-store'
          });
          clearTimeout(timer);
          if (!res.ok) throw new Error('fetch not ok');
          const data = await res.json();
          if (!data || data.ok !== true) throw new Error('bad data');
          renderCount(data);
        }catch(errFetch){
          try{
            const data = await jsonp(WEBAPP_URL + '?action=hit');
            if (!data || data.ok !== true) throw new Error('jsonp bad data');
            renderCount(data);
          }catch(errJsonp){
            try{
              const key = todayKeySeoul();
              const stored = JSON.parse(localStorage.getItem('visit-count') || '{}');
              stored[key] = (stored[key] || 0) + 1;
              localStorage.setItem('visit-count', JSON.stringify(stored));
              el.textContent = stored[key];
              el.setAttribute('title','전역 합계 서버 연결 실패: 임시 로컬 카운트');
            }catch(e2){ el.textContent = '–'; }
          }
        }
      }
      updateVisitorCountGlobal();

      /* ====== 팝업(오늘 하루 열지 않기) ====== */
      const MODAL_ID = 'intro-modal';
      const HIDE_KEY = 'intro-hide-date';
      const modal = document.getElementById(MODAL_ID);
      const iframeIntro = document.getElementById('intro-iframe');
      const btnClose = document.getElementById('intro-close');
      const btnCloseX = document.getElementById('intro-close-x');
      const chkDont = document.getElementById('dont-show-today');
      const linkReopen = document.getElementById('reopen-intro');

      /* 배경 스크롤 잠그기(모바일 안전) */
      let _savedScrollY = 0;
      function lockScroll(lock){
        const html = document.documentElement;
        if (lock){
          _savedScrollY = window.scrollY || 0;
          html.style.position = 'fixed';
          html.style.top = '-' + _savedScrollY + 'px';
          html.style.left = '0';
          html.style.right = '0';
          html.style.overflow = 'hidden';
          html.style.width = '100%';
        }else{
          const y = _savedScrollY;
          html.style.position = '';
          html.style.top = '';
          html.style.left = '';
          html.style.right = '';
          html.style.overflow = '';
          html.style.width = '';
          window.scrollTo(0, y);
        }
      }

      /* 동일 출처일 때 iframe 자동 높이 */
      function attachIntroAutoSize(){
        try{
          const doc = iframeIntro.contentDocument || iframeIntro.contentWindow.document;
          if (!doc) return;
          const setH = function(){
            const body = doc.body, html = doc.documentElement;
            const h = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);
            iframeIntro.style.height = Math.max(600, h) + 'px';
            iframeIntro.style.display = 'block';
          };
          setH();
          new MutationObserver(setH).observe(doc.documentElement, { childList:true, subtree:true, attributes:true });
          iframeIntro.contentWindow.addEventListener('load', setH);
        }catch(e){
          /* 교차 출처면 iframe 자체 스크롤 */
          iframeIntro.style.height = '100%';
        }
      }

      function todayHideSet(){ try{ localStorage.setItem(HIDE_KEY, todayKeySeoul()); }catch(e){} }
      function todayHideCheck(){
        try{ return localStorage.getItem(HIDE_KEY) === todayKeySeoul(); }
        catch(e){ return false; }
      }

      function openIntro(){
        iframeIntro.addEventListener('load', attachIntroAutoSize, { once:true });
        if (!iframeIntro.src){ iframeIntro.src = iframeIntro.dataset.src; }
        modal.hidden = false; lockScroll(true);
      }
      function closeIntro(){
        if (chkDont && chkDont.checked){ todayHideSet(); }
        modal.hidden = true; lockScroll(false);
      }

      if (!todayHideCheck()) openIntro();

      if (btnClose) btnClose.addEventListener('click', closeIntro);
      if (btnCloseX) btnCloseX.addEventListener('click', closeIntro);
      modal.addEventListener('click', function(e){ if (e.target === modal) closeIntro(); });
      document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && !modal.hidden) closeIntro(); });
      if (linkReopen) linkReopen.addEventListener('click', function(e){
        e.preventDefault(); try{ localStorage.removeItem(HIDE_KEY); }catch(_){}
        if (chkDont) chkDont.checked = false; openIntro();
      });
    })();
  </script>
</body>
</html>
